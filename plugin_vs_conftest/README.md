# Plugin vs Conftest Experiment
This experiment is meant to illustrate the precedence between a common fixture present in both a plugin
as well as a conftest file and to settle where the override will occur.

## Directory Structure
A test module in a nested subfolder and a plugins folder with a single plugin defined. One root level
conftest file is present as well which will be put toe to toe with the plugin.py common fixture.

```shell
plugin_vs_conftest/
├── README.md
├── conftest.py
├── tests
│   └── test_module.py
└── plugins
    └── plugin.py
```

## Overview

What we find in this experiment is that the test module resolves its fixtures from the plugins followed
by the conftest definitions. Therefore the conftest definitions hold precedence over the plugin
provided definitions.

## Test Results

The following is the console output generated by running pytest over the test folder.

```shell
$ pytest plugin_vs_conftest/ --verbose
================================================== test session starts ===================================================
platform darwin -- Python 3.7.3, pytest-5.0.1, py-1.8.0, pluggy-0.12.0 -- /Users/USERX/anaconda3/bin/python
cachedir: .pytest_cache
rootdir: /Users/USERX/pytest_behavior
plugins: openfiles-0.3.2, arraydiff-0.3, doctestplus-0.3.0, cases-2.2.5, remotedata-0.3.1
collected 4 items

plugin_vs_conftest/tests/test_module.py::test_control PASSED                                                        [ 25%]
plugin_vs_conftest/tests/test_module.py::test_plugin FAILED                                                         [ 50%]
plugin_vs_conftest/tests/test_module.py::test_conftest PASSED                                                       [ 75%]
plugin_vs_conftest/tests/test_module.py::test_plugin_only_fixture PASSED                                            [100%]

======================================================== FAILURES ========================================================
______________________________________________________ test_plugin _______________________________________________________

common_fix = 'from_conftest'

    def test_plugin(common_fix):
>       assert common_fix == "from_plugin"
E       AssertionError: assert 'from_conftest' == 'from_plugin'
E         - from_conftest
E         + from_plugin

plugin_vs_conftest/tests/test_module.py:7: AssertionError
=========================================== 1 failed, 3 passed in 0.06 seconds ===========================================
3848-laptop:pytest_behavior USERX$
```

## Observations

From the set of test cases it is the `test_plugin` case which fails, and that immediately indicates to us
that the plugin definitions hold a lower precedence level than the conftest definitions. The fact that
the other test case `test_plugin_only_fixture` passes indicates that fixtures are in fact visible from
the plugins source. Therefore `common_fix` is taking its definition from the root `conftest.py` file.
Furthermore if you move the conftest definition to `tests/conftest.py` you'd find the same precedence
rule applies.

```
plugin_vs_conftest/tests/test_module.py::test_control PASSED
plugin_vs_conftest/tests/test_module.py::test_plugin FAILED
plugin_vs_conftest/tests/test_module.py::test_conftest PASSED
plugin_vs_conftest/tests/test_module.py::test_plugin_only_fixture PASSED
```

<br><br>

# Summary
In a nutshell conftest definitions take precedence over plugins definitions.
`conftest > plugins`
